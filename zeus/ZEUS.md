# Forenote
If attempting to replicate below steps, **ADHERE TO CAUTION**. View Grant Collins' playlist in the [README.md](https://github.com/mkathia/malware-analysis/edit/main/README.md) file for a more detailed instruction set. 

# Project Overview
WIP

# Downloading the Malware
To obtain the malicious sample, we must temporarily provide our target system with internet access. To do so, we change it from the previous host-only adapter to a bridged adapter, as seen below.

![image](https://github.com/mkathia/malware-analysis/assets/113075504/d8e501e5-0bd4-4465-802a-5d008df2ee19)

Then, we can download our malware from the Github page, as seen below.

![downloadingzeus](https://github.com/mkathia/malware-analysis/assets/113075504/d4226b68-bcab-445d-9b46-17f472ceac29)


# Extracting the Malware
With our malicious sample on the computer, we open the archive and view the file. We extract this file from the archive and place it on our desktop.

![extractingzeus](https://github.com/mkathia/malware-analysis/assets/113075504/4d7e4e99-973f-4c2b-970f-3419904a71c1)

# Fingerprinting

Our first step in analyzing this piece of malware is fingerprinting it. 

We can document the name of the malware: _invoice_2318362983713_823931342io.pdf.exe_
Note the double extension, this is used to take advantage of indiviudals who do not have their computers configured to view full file extensions.

Next, we provide it to a website known as VirusTotal, and see what the output provides.

![virustotaloutput](https://github.com/mkathia/malware-analysis/assets/113075504/bcc55c2c-0b96-4980-abbe-e2d396619a83)

Clearly, the file we have is malicious. The majority of security vendors flag this file. 

After doing this, we no longer need internet connection, so we immediately revert our changes to the internet to once again isolate the machines in their own network. Just to ensure connectivity, we re-ping the machines, as we did in the [README.md](https://github.com/mkathia/malware-analysis/edit/main/README.md) file. Once seeing that the connection is there, we know everything is well, and we can further proceed with our malware analysis.

Our next steps involve a software known as pestudio, a malware analysis tool. When we provide pestudio our malware, one of the first things seen is the hashes of the malware. These hashes will be documented. We can also document the first 64 bytes of the hex dump, and the fact that the first-bytes-text contains M Z, which denotes that this file is an executable.

![pestudiohash](https://github.com/mkathia/malware-analysis/assets/113075504/f6c8838b-7757-42f9-aba2-78591df90f90)

We can also look at the export section, which contains a domain, _corect.com_. 

![image](https://github.com/mkathia/malware-analysis/assets/113075504/f9cf4a74-ac2b-4608-b32a-d6ce62ab74e6)

Documenting this concludes our fingerprinting.

# Static Analysis

To begin our static analysis, we look through the "sections" tab. In this section, we can see the raw and virtual sizes of the executable. Malware authors sometimes "pack" their malware to obfuscate it and to deter analysis. This can be signified by a wildly differing raw and virtual size. Thankfully for us, we can see that the sizes are relatively similar, so the malware is not packed.

![pestudiosectionspacked](https://github.com/mkathia/malware-analysis/assets/113075504/c20da502-c6ce-4632-b1e3-6d2725bf2a20)

Next, we look through the "strings" tab. In this tab, we can see different strings utilized inside the executable. pestudio flags some of these strings, and when filtering by flags, we can easily view them. 

![pestudioflaggedstrings](https://github.com/mkathia/malware-analysis/assets/113075504/313df247-99d5-48a1-b18d-15a341bdb0f8)

These strings are to be documented. Furthermore, as we look through the rest of the strings, we can eventually see a pattern.

![pestudiokerneluser32](https://github.com/mkathia/malware-analysis/assets/113075504/ce0dcab3-6162-436a-a74a-19193ccad2ce)

The strings are alternating between junk lines and calls to either KERNEL32 or USER32. This is also intriguing, and should be documented.

Continuing on to the libraries section, we note that the three being called are SHLWAPI.dll, KERNEL32.dll, and USER32.dll

![image](https://github.com/mkathia/malware-analysis/assets/113075504/6602907d-154d-46f3-8d5a-b17f865d7c04)

This concludes our use of pestudio.

Next, we open cmder as an enhanced terminal, and run floss on our executable and redirect the output to a text file.

![floss_loading](https://github.com/mkathia/malware-analysis/assets/113075504/6de2266a-734a-4292-a14e-81deb227694b)

When looking at the output of this call, we search for .com and other domain names. We find a .com domain, _corect.com_. We encountered this domain previously, and thus it is already documented.

This concludes our use of floss.

Next, we proceed to use capa to anaylze the malware. The output provided is below.

![image](https://github.com/mkathia/malware-analysis/assets/113075504/4ce9de21-96ed-4035-be88-33bddcf2e5a4)

capa attempts to map the malware's behavior to the MITRE Attack Framework. Thus, we can see that the attack tactic is _DEFENSE EVASION_, and the technique is _Virtualization/Sandbox Evasion_. It also mentions _ANTI-BEHAVIORAL ANALYSIS_, _Virtual Machine Detection_, and lists a few capabilities. 

We re-run capa with a -vv flag, which has capa attempt to find where in the code the aforementioned capabilities originate from. Output is below.

![capavv](https://github.com/mkathia/malware-analysis/assets/113075504/3f4ec19a-4527-4bd9-a017-670653f58116)

This concludes our use of capa. 

We proceed to analyze the domain that we found numerous times earlier, _corect.com_. We provide it to VirusTotal, and are shown that there is no malicous activity.
![image](https://github.com/mkathia/malware-analysis/assets/113075504/a467c06a-a244-4333-ab7d-dff781e0ba0a)

Next, we access the WayBackMachine, which takes snapshots of websites for archiving purposes. When we pick a random date in 2013, we see this.

![image](https://github.com/mkathia/malware-analysis/assets/113075504/68fa9e3e-02fb-41af-b198-5631d6b25595)

Pasting text into Google Translate, we can see that this seems to be a news site. Thus, it can be concluded that the domain yields no results.

To continue our static analysis, we will be using Cutter. After giving it the file, we see a bunch of information that we have seen before, such as the hashes and the libraries. 

![cutterhomepage](https://github.com/mkathia/malware-analysis/assets/113075504/9338995b-738b-4aaf-b3ef-bbca7d465f5e)


